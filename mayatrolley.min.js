function main(){var a={colors:{},markerGroup:L.featureGroup(),layerControl:L.control.layers(null,{},{position:"topleft",collapsed:!1}),map:createMap(),param:getParam("maptype")};tileLayer().addTo(a.map),getAllRoutes(a)}function createMap(){return L.map("map",{center:DEFAULTS.CENTER,zoom:DEFAULTS.ZOOM})}function tileLayer(){var a="https://{s}.tiles.mapbox.com/v3/vramirez122000.kc4acpgn/{z}/{x}/{y}.png";return L.tileLayer(a,{minZoom:DEFAULTS.MIN_ZOOM,maxZoom:DEFAULTS.MAX_ZOOM,maxBounds:DEFAULTS.BOUNDS,attribution:'<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap Contributors</a>'})}function getAllRoutes(a){$.ajax("rutas.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=b.features[c];if(!a.param||-1!=d.properties.nombre.indexOf(a.param)){var e=L.geoJson(d,{style:createRouteStyleFunction(a),onEachFeature:createOnEachRouteFunction(a)});a.colors[d.properties.nombre]=d.properties.color;var f=d.properties.color,g=shadeColor(d.properties.color,-25),h='<span class="routeLabel" style="background-color: '+f+"; text-shadow: -1px 0 "+g+", 0 1px "+g+", 1px 0 "+g+", 0 -1px "+g+"; border-color: "+g+'">'+d.properties.nombre+"</span>";a.param==d.properties.nombre,e.addTo(a.map),a.layerControl.addOverlay(e,h)}}a.markerGroup.getLayers().length&&a.markerGroup.bringToFront(),a.layerControl.addTo(a.map),getPoints(a),a.map.locate({setView:!0,maxZoom:13,enableHighAccuracy:!0})}})}function getPoints(a){$.ajax("puntos.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=b.features[c],e=d.properties.text.substr(0,2),f=a.colors[e],g=f||"#ffffff",h=f&&shadeColor(g,-30)||"#555555",i=L.circleMarker(d.geometry.coordinates.reverse(),{color:h,fillColor:g,fillOpacity:1,radius:"6"});i.bindPopup(d.properties.text),a.markerGroup.addLayer(i)}a.markerGroup.addTo(a.map)}})}function createRouteStyleFunction(){return function(a){var b={weight:6,opacity:DEFAULTS.ROUTE_COLOR_OPACITY,color:a.properties.color,lineCap:"butt"};return a.properties.nombre.indexOf("Rural")>-1&&(b.dashArray="10,4"),b}}function createOnEachRouteFunction(a){return function(b,c){c.bindPopup(b.properties.nombre),c.on("click",function(){c.bringToFront(),a.markerGroup.bringToFront()})}}function getParam(a){var b=new RegExp("[?&]"+encodeURIComponent(a)+"=([^&]*)").exec(location.search);if(b){var c=decodeURIComponent(b[1]);return c.indexOf("/")==c.length-1&&(c=c.substring(0,c.length-1)),c}}function shadeColor(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}var DEFAULTS={CENTER:[18.2011,-67.1396],ZOOM:13,MIN_ZOOM:10,MAX_ZOOM:19,BOUNDS:[[18.352687,-66.179752],[18.477284,-65.928097]],ROUTE_COLOR_OPACITY:.8};