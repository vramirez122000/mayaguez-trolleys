var maya=function(){function a(){return L.map("map",{center:k.CENTER,zoom:k.ZOOM})}function b(){var a="https://{s}.tiles.mapbox.com/v3/vramirez122000.kc4acpgn/{z}/{x}/{y}.png";return L.tileLayer(a,{minZoom:k.MIN_ZOOM,maxZoom:k.MAX_ZOOM,maxBounds:k.BOUNDS,attribution:'<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap Contributors</a>'})}function c(a,b){$.ajax("rutas.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=b.features[c];if(!(a.routes.length>0&&-1==a.routes.indexOf(d.id))){var e=L.geoJson(d,{style:f(),onEachFeature:g(a)});a.colors[d.id]=d.properties.color;var h=d.properties.color,j=i(d.properties.color,-25),k='<span class="routeLabel" style="background-color: '+h+"; text-shadow: -1px 0 "+j+", 0 1px "+j+", 1px 0 "+j+", 0 -1px "+j+"; border-color: "+j+'">'+d.properties.nombre+"</span>";a.routeGroup.addLayer(e),e.addTo(a.map),a.layerControl.addOverlay(e,k)}}a.stopGroup.getLayers().length&&a.stopGroup.bringToFront(),a.layerControl.addTo(a.map)},complete:b})}function d(a,b){$.ajax("paradas.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=b.features[c],e=d.properties.route;if(e in a.colors){var f=a.colors[e],g=f||"#ffffff",h=f&&i(g,-30)||"#555555",j=L.circleMarker(d.geometry.coordinates.reverse(),{color:h,fillColor:g,fillOpacity:1,radius:"6"});j.bindPopup(d.properties.text),a.stopGroup.addLayer(j)}}a.stopGroup.addTo(a.map)},complete:b})}function e(a,b){$.ajax("poi.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=b.features[c],e={prefix:"fa"};d.properties.color&&(e.markerColor=d.properties.color),d.properties.icon&&(e.icon=d.properties.icon);var f=L.marker(d.geometry.coordinates.reverse(),{icon:L.AwesomeMarkers.icon(e)});f.bindPopup(d.properties.name),a.poiGroup.addLayer(f)}a.layerControl.addOverlay(a.poiGroup,"Puntos de Referencia")},complete:b})}function f(){return function(a){var b={weight:6,opacity:k.ROUTE_COLOR_OPACITY,color:a.properties.color,lineCap:"butt"};return a.properties.nombre.indexOf("Rural")>-1&&(b.dashArray="10,4"),b}}function g(a){return function(b,c){c.bindPopup(b.properties.nombre),c.on("click",function(){c.bringToFront(),a.stopGroup.bringToFront()})}}function h(a){var b=new RegExp("[?&]"+encodeURIComponent(a)+"=([^&]*)").exec(location.search);if(b){var c=decodeURIComponent(b[1]);return c.indexOf("/")==c.length-1&&(c=c.substring(0,c.length-1)),c}}function i(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}var j={},k={CENTER:[18.2011,-67.1396],ZOOM:13,MIN_ZOOM:10,MAX_ZOOM:19,BOUNDS:[[18.352687,-66.179752],[18.477284,-65.928097]],ROUTE_COLOR_OPACITY:.8};return j.main=function(){var f=h("routes"),g=f&&f.split(",")||[],i={colors:{},stopGroup:L.featureGroup(),routeGroup:L.featureGroup(),poiGroup:L.featureGroup(),layerControl:L.control.layers(null,{},{position:"topleft",collapsed:!1}),map:a(),routes:g};b().addTo(i.map),c(i,function(){d(i,function(){i.map.fitBounds(i.routeGroup.getBounds())})}),e(i,function(){})},j}();