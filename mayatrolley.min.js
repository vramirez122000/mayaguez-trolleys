var maya=function(){function a(){return L.map("map",{center:j.CENTER,zoom:j.ZOOM})}function b(){var a="https://{s}.tiles.mapbox.com/v3/vramirez122000.kc4acpgn/{z}/{x}/{y}.png";return L.tileLayer(a,{minZoom:j.MIN_ZOOM,maxZoom:j.MAX_ZOOM,maxBounds:j.BOUNDS,attribution:'<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap Contributors</a>'})}function c(a,b){$.ajax("rutas.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(c){for(var d=0;d<c.features.length;d++){var g=c.features[d];if(!(a.routes.length>0&&-1==a.routes.indexOf(g.id))){var i=L.geoJson(g,{style:e(),onEachFeature:f(a)});a.colors[g.id]=g.properties.color;var j=g.properties.color,k=h(g.properties.color,-25),l='<span class="routeLabel" style="background-color: '+j+"; text-shadow: -1px 0 "+k+", 0 1px "+k+", 1px 0 "+k+", 0 -1px "+k+"; border-color: "+k+'">'+g.properties.nombre+"</span>";a.routeGroup.addLayer(i),i.addTo(a.map),a.layerControl.addOverlay(i,l)}}a.stopGroup.getLayers().length&&a.stopGroup.bringToFront(),a.layerControl.addTo(a.map),b()}})}function d(a){$.ajax("paradas.geojson",{contentType:"application/json; charset=UTF-8",dataType:"json",success:function(b){for(var c=0;c<b.features.length;c++){var d=b.features[c],e=d.properties.route;if(e in a.colors){var f=a.colors[e],g=f||"#ffffff",i=f&&h(g,-30)||"#555555",j=L.circleMarker(d.geometry.coordinates.reverse(),{color:i,fillColor:g,fillOpacity:1,radius:"6"});j.bindPopup(d.properties.text),a.stopGroup.addLayer(j)}}a.stopGroup.addTo(a.map)}})}function e(){return function(a){var b={weight:6,opacity:j.ROUTE_COLOR_OPACITY,color:a.properties.color,lineCap:"butt"};return a.properties.nombre.indexOf("Rural")>-1&&(b.dashArray="10,4"),b}}function f(a){return function(b,c){c.bindPopup(b.properties.nombre),c.on("click",function(){c.bringToFront(),a.stopGroup.bringToFront()})}}function g(a){var b=new RegExp("[?&]"+encodeURIComponent(a)+"=([^&]*)").exec(location.search);if(b){var c=decodeURIComponent(b[1]);return c.indexOf("/")==c.length-1&&(c=c.substring(0,c.length-1)),c}}function h(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}var i={},j={CENTER:[18.2011,-67.1396],ZOOM:13,MIN_ZOOM:10,MAX_ZOOM:19,BOUNDS:[[18.352687,-66.179752],[18.477284,-65.928097]],ROUTE_COLOR_OPACITY:.8};return i.main=function(){var e=g("routes"),f=e&&e.split(",")||[],h={colors:{},stopGroup:L.featureGroup(),routeGroup:L.featureGroup(),layerControl:L.control.layers(null,{},{position:"topleft",collapsed:!1}),map:a(),routes:f};b().addTo(h.map),c(h,function(){h.map.fitBounds(h.routeGroup.getBounds()),d(h)})},i}();